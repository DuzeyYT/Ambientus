package me.lca.skush.module.impl.exploits;

import com.google.common.eventbus.Subscribe;
import me.lca.skush.Ambien;
import me.lca.skush.event.impl.EventPacket;
import me.lca.skush.event.impl.EventUpdate;
import me.lca.skush.interfaces.ModuleInterface;
import me.lca.skush.module.Category;
import me.lca.skush.module.Module;
import me.lca.skush.utils.TimeUtil;
import net.minecraft.client.Minecraft;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C0APacketAnimation;
import net.minecraft.network.play.client.C0FPacketConfirmTransaction;

import java.util.ArrayList;

import static com.ambientus.api.PacketUtil.*;

@ModuleInterface(name = "SentinelFixer", displayName = "SentinelFixer", category = Category.Exploits)
public class SentinelFixer extends Module {
    private TimeUtil timeHelper = new TimeUtil();
    private ArrayList<Packet> packetQueue = new ArrayList<>();

    @Subscribe
    public void onUpdate(EventUpdate event) {
        double delay = 100D;

        /* Senc C0A */
        if(packetQueue != null && packetQueue.size() > 0) {
            if (timeHelper.isDelayComplete(delay)) {
                Ambien.INSTANCE.sendMessage("Sent C0A!: " + packetQueue.size());
                sendPacketSilent(packetQueue.get(0));
                packetQueue.remove(0);
                timeHelper.setLastMS();
            }
        }
    }

    @Subscribe
    public void onPacket(EventPacket event) {
        Packet packet = event.getPacket();
        if(packet instanceof C0APacketAnimation) {
            Ambien.INSTANCE.sendMessage("Blocked C0A!: " + packetQueue.size());
            packetQueue.add(packet);
            event.setCancelled(true);
        }
    }

    @Override
    public void onDisable() {
        super.onDisable();

        timeHelper.setLastMS();
        if(packetQueue.size() > 0)
            packetQueue.clear();
    }
}
