package me.lca.skush.module.impl.exploits;

import me.lca.skush.Ambien;
import me.lca.skush.event.EventTarget;
import me.lca.skush.event.impl.EventPacket;
import me.lca.skush.event.impl.EventUpdate;
import me.lca.skush.interfaces.ModuleInterface;
import me.lca.skush.module.Category;
import me.lca.skush.module.Module;
import me.lca.skush.utils.TimeUtil;
import net.minecraft.client.Minecraft;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C0APacketAnimation;
import net.minecraft.network.play.client.C0FPacketConfirmTransaction;
import net.minecraft.network.play.client.C13PacketPlayerAbilities;

import java.util.ArrayList;

import static com.ambientus.api.PacketUtil.*;

@ModuleInterface(name = "SentinelFixer", displayName = "SentinelFixer", category = Category.Exploits)
public class SentinelFixer extends Module {
    private TimeUtil timeHelper = new TimeUtil();
    private ArrayList<Packet> packetQueue = new ArrayList<>();

    @EventTarget
    public void onUpdate(EventUpdate event) {
        double delay = 100D;

        /* Senc C0A */
        if(packetQueue != null && packetQueue.size() > 0 && timeHelper.isDelayComplete(delay)) {
            Packet packet = packetQueue.get(0);
            sendPacketSilent(packet);
            packetQueue.remove(packetQueue.get(0));
            timeHelper.setLastMS();
        }
    }

    @EventTarget
    public void onPacket(EventPacket event) {
        Packet packet = event.getPacket();
        if(packet instanceof C0APacketAnimation) {
            packetQueue.add(packet);
            event.setCancelled(true);
        }
    }

    @Override
    public void onDisable() {
        super.onDisable();

        timeHelper.setLastMS();
        if(packetQueue.size() > 0)
            packetQueue.clear();
    }
}
